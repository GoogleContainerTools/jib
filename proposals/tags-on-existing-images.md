# Proposal: Control the pushing of tags on existing images in target registry

Relevant issues: [#2360](https://github.com/GoogleContainerTools/jib/issues/2360)

## Motivation
Currently Jib pushes tags for all built images, irrelevant of whether the image is already 
present on the target registry. 

As highlighted by @loosebazooka [#2360](https://github.com/GoogleContainerTools/jib/issues/2360) 
this can be particularly annoying if some automated orchestrator is monitoring the registry
and releases any new tags found. This issue is especially prevalent in cases where the tags are
auto-generated by CI systems and added with every triggered build.

## Proposal
The idea is to give the user the ability to control this functionality by means of a switch/option. 
There might be use-cases where the current behaviour is preferable, eg, where the tags follow semantic 
versioning, or where the tags are not automatically generated. Hence, adding a switch seems to be 
a better solution rather than changing the current behaviour.

## Solution
A check is to be added prior to pushing images, and depending on the result of the check and the
user's configuration preference, decide whether to push or not the new image.

A similar check is already being done in `PushBlobStep` where a call to `registryClient.checkBlob()` 
is being performed before a blob is pushed to the target registry.

The `PushImageStep` is the class responsible to push manifests to the target repository.

A new method was added to the `RegistryClient`; `checkManifest()`. This is arguably unnecessary
since it uses the `pullManifest()` function, however it seems convenient.
 
This check was added to the `PushImageStep` and is only executed if the user switches off
the configuration switch.

A configuration option was added to control this functionality: `allowTagsOnExistingImages`.